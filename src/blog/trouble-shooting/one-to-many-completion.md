## 1대N 관계에서 모든 N이 완료되었는지 체크하는 방법

- 발생일: 2024-12-01
- 문제: 선생님이 숙제나 수업의 문제들을 O/X로 채점한 후, 해당 숙제/수업이 완전히 완료되었는지 확인하는 효율적인 방법이 필요
- 오류

```
시나리오:
1. 선생님이 학생의 여러 문제에 대해 O/X 입력
2. 모든 문제가 채점되면 해당 handout이나 session을 "resolved"로 마킹
3. 100개의 미완료 세션이 있을 때, 매번 모든 세션을 체크하면 비효율적
```

- 원인 파악:
    - 폴리모픽 참조(polymorphic reference)로 assignment 테이블을 만들면 SQL에서 정식 외래키를 사용할 수 없음
    - 모든 세션을 루프 돌며 체크하면 O(n) 비효율 발생
    - 단일 업데이트마다 전체 completion 상태를 체크하는 것은 과도함

- 해결:
    1. **배치 업데이트 패턴**:
        - 모든 O/X 업데이트를 먼저 `student_question` 테이블에 기록
        - 변경된 question들로부터 영향받는 handout_id/session_id 목록 추출
        - 해당 목록에 대해서만 completion 체크

- 소요 시간: 45분 (DB 스키마 설계 + 배치 처리 로직 구상)

